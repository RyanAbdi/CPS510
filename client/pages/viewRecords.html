<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toronto KittyCab | View Records</title>
    <link rel="stylesheet" type="text/css" href="../css/viewRecords.css">
    <link rel="stylesheet" type="text/css" href="../css/styles.css">
    <script src="../components/navbar.js" type="text/javascript" defer></script>
    <script src="../js/viewRecords.js" type="text/javascript" defer></script>
    <!--<link rel="icon" href="./media/" type="image/*"> -->
</head>
<body>
    <navbar-component></navbar-component>
    <div class="content">
        <div class="view-records-container" id="view-records">
            <a href="viewTables.html" class="go-back-btn">&larr; Go Back</a>
            <h1>View Records</h1>
            <p>Table: <span id="table-name"></span></p>
            <table class="styled-table" id="records-container">
                <thead>
                    <tr></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <script src="../js/selectTable.js"></script>
   
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const records = await myFunction();
            console.log(records);

            const recordsContainer = document.getElementById('records-container');

            const table = document.createElement('table');
            table.classList.add('styled-table');

            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            
            Object.keys(records[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            
            const editDeleteHeader = document.createElement('th');
            editDeleteHeader.textContent = 'Edit and Delete';
            headerRow.appendChild(editDeleteHeader);

            thead.appendChild(headerRow);
            table.appendChild(thead);

            const tbody = document.createElement('tbody');

            records.forEach((record, index) => {
                const row = document.createElement('tr');

                Object.entries(record).forEach(([key, value]) => {
                    const td = document.createElement('td');
                    td.textContent = value;
                    row.appendChild(td);
                });

                const editButton = document.createElement('button');
                editButton.textContent = 'Edit';
                editButton.classList.add('edit-button');
                editButton.addEventListener('click', function editClickHandler() {
                            row.querySelectorAll('td:not(:last-child)').forEach((cell, cellIndex) => {
                            cell.setAttribute('contenteditable', true);
                            
                    });
                    const firstCell = row.firstElementChild;
                    firstCell.focus();
                    const range = document.createRange();
                    range.selectNodeContents(firstCell);
                    const sel = window.getSelection();
                    sel.removeAllRanges();
                    sel.addRange(range);

                    editButton.textContent = 'Save';
                    editButton.removeEventListener('click', editClickHandler);
                    editButton.addEventListener('click', function saveClickHandler() {
                        row.querySelectorAll('td').forEach((cell, cellIndex) => {
                            cell.setAttribute('contenteditable', false);
                        });

                        editButton.textContent = 'Edit';
                        editButton.removeEventListener('click', saveClickHandler);
                        editButton.addEventListener('click', editClickHandler);
                    });
                });

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.classList.add('delete-button');
                deleteButton.addEventListener('click', () => {
                    console.log(`Delete button clicked for row ${index}`);
                });

                const editDeleteCell = document.createElement('td');
                editDeleteCell.appendChild(editButton);
                editDeleteCell.appendChild(deleteButton);

                row.appendChild(editDeleteCell);
                tbody.appendChild(row);
            });

            table.appendChild(tbody);

            recordsContainer.appendChild(table);
        });
    </script>

    <footer>
        <div class="copyright">
            &copy; Toronto KittyCab 2023
        </div>
    </footer>
</body>

</html>